import{o as n,c as s,d as a}from"./app.e9024871.js";const p='{"title":"es6-03 类、set、map","description":"","frontmatter":{},"headers":[{"level":2,"title":"一、类","slug":"一、类"},{"level":3,"title":"什么是类","slug":"什么是类"},{"level":3,"title":"类的三大特性","slug":"类的三大特性"},{"level":3,"title":"类的基本语法","slug":"类的基本语法"},{"level":3,"title":"类的定义方法","slug":"类的定义方法"},{"level":3,"title":"类的继承","slug":"类的继承"},{"level":2,"title":"二、set数组","slug":"二、set数组"},{"level":3,"title":"Set原型上的方法","slug":"set原型上的方法"},{"level":3,"title":"集合数组方法","slug":"集合数组方法"},{"level":2,"title":"三、WeakSet","slug":"三、weakset"},{"level":2,"title":"四、map对象","slug":"四、map对象"},{"level":3,"title":"map实用技巧","slug":"map实用技巧"},{"level":2,"title":"四、WeakMap对象","slug":"四、weakmap对象"},{"level":3,"title":"WeakMap内存实例","slug":"weakmap内存实例"}],"relativePath":"src/frontend/es6/es6-03 类、set、map.md","lastUpdated":1615699077436}',t={},o=a('<h1 id="es6-03-类、set、map"><a class="header-anchor" href="#es6-03-类、set、map" aria-hidden="true">#</a> es6-03 类、set、map</h1><h2 id="一、类"><a class="header-anchor" href="#一、类" aria-hidden="true">#</a> 一、类</h2><p>使用类定义面向对象不需要function，直接 <code>方法名(){}</code>；</p><h3 id="什么是类"><a class="header-anchor" href="#什么是类" aria-hidden="true">#</a> 什么是类</h3><p>类是具有相同属性和方法(行为)的一类事务的集合</p><p>对象：类实例化后的某个具体的个体，使用类创建对象必须new</p><p>属性通过constructor构造器来定义属性,构造器在类实例化时会被自动调用</p><h3 id="类的三大特性"><a class="header-anchor" href="#类的三大特性" aria-hidden="true">#</a> 类的三大特性</h3><ul><li><p>封装、</p></li><li><p>继承：在对原有类的属性及方法保留同时进行功能扩展</p></li><li><p>多态：根据不同的上下文环境表现出不同的形态</p></li></ul><h3 id="类的基本语法"><a class="header-anchor" href="#类的基本语法" aria-hidden="true">#</a> 类的基本语法</h3><ol><li><p>通过class定义类</p></li><li><p>在类中通过constructor定义构造方法</p></li><li><p>通过new来创建类的实例</p></li><li><p>通过extends来实现类的继承</p></li><li><p>通过super调用父类的构造方法</p></li></ol><h3 id="类的定义方法"><a class="header-anchor" href="#类的定义方法" aria-hidden="true">#</a> 类的定义方法</h3><div class="language-js"><pre><code><span class="token keyword">class</span> <span class="token class-name">People</span><span class="token punctuation">{</span>\n    <span class="token keyword">static</span> className <span class="token operator">=</span> <span class="token string">&#39;hello&#39;</span>   <span class="token comment">// 静态属性，实例对象通过__proto__来访问，内部使用people来调用；</span>\n    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">names<span class="token punctuation">,</span>ages</span><span class="token punctuation">)</span><span class="token punctuation">{</span>   <span class="token comment">//使用constructor来定义属性；</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> names<span class="token punctuation">;</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>ages <span class="token operator">=</span> ages<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment">//方法直接定义；</span>\n    <span class="token keyword">static</span> <span class="token function">setRandom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>   <span class="token comment">//通过People来调用这个方法；</span>\n<span class="token punctuation">}</span>\n</code></pre></div><p>静态属性是使用类名去访问的，而类里面的是使用this去访问的，创建<code>static</code>的区别在于不需要使用this，这样this不会乱；</p><p>静态属性不需要实例化就可以直接调用，可以直接通过点静态的属性去调用；</p><h3 id="类的继承"><a class="header-anchor" href="#类的继承" aria-hidden="true">#</a> 类的继承</h3><ul><li><p>当子类中定义了constructor构造器时，则要在构造器中调用super()方法，通过super()方法给父类中的属性设置属性值，如果不需要修改或新增属性，则不需要写constructor；</p></li><li><p>方法重构:当父类中的方法在子类满足不了需求时，则要在子类中定义和父类同名的方法；</p></li><li><p>同一个类可以被多次继承；</p></li></ul><div class="language-js"><pre><code><span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token keyword">extends</span> <span class="token class-name">People</span><span class="token punctuation">{</span>\n    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">names<span class="token punctuation">,</span>ages</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n        <span class="token keyword">super</span><span class="token punctuation">(</span>names<span class="token punctuation">,</span>ages<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">//必须调用此方法，括号接收属性；</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre></div><p><code>prototype</code> 是原型 这是在构造函数上的</p><p><code>__proto__</code> 是原型链 实例对象访问的</p><p><code>super</code>作为函数，指向父类的constructor，因此super需要调用对应的参数；</p><p>super作为对象时</p><ul><li>在普通方法中使用：指向父类的原型对象</li><li>在静态方法中：指向父类</li></ul><h2 id="二、set数组"><a class="header-anchor" href="#二、set数组" aria-hidden="true">#</a> 二、set数组</h2><blockquote><p>类似于数组，里面的每一项都是唯一的，没有重复的值；</p></blockquote><ol><li><p>使用Set必须new，返回一个对象，只能用for..of取值；</p></li><li><p>Set这种数据结构经常和一维数组搭配使用，如果数组里面有重复的项，则会自动删除；</p></li></ol><p><code>let sets = new Set([1,2,3,2,1])</code>;</p><p>可以使用：<code>Array.from(new Set([1,2,1]))</code> 转换为可以遍历的数组；</p><p>或：<code>[...new Set([1,2,1])]</code>；...将数组展开，之后添加数组；</p><h3 id="set原型上的方法"><a class="header-anchor" href="#set原型上的方法" aria-hidden="true">#</a> Set原型上的方法</h3><ul><li><code>add</code>(value)：增加；</li><li><code>delete</code>(value)：删除；</li><li><code>has</code>(value)：是否有；</li><li><code>clear</code>：清空</li><li><code>size</code>：同length一样；</li></ul><h3 id="集合数组方法"><a class="header-anchor" href="#集合数组方法" aria-hidden="true">#</a> 集合数组方法</h3><ul><li>声明：<code>const a = new Set(arr1)</code></li><li>并集：<code>new Set([...a,...b])</code></li><li>交集：<code>new Set([...a].filter(v=&gt;b.has(v)))</code></li><li>差集：<code>new Set([...a].filter(v=&gt;!b.has(v)))</code></li></ul><h2 id="三、weakset"><a class="header-anchor" href="#三、weakset" aria-hidden="true">#</a> 三、WeakSet</h2><ol><li>WeakSet结构与Set类似，里面的值都是弱引用；</li><li>WeakSet的成员只能是对象，而不能是其他类型的值；</li></ol><div class="language-js"><pre><code><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span>\n<span class="token keyword">let</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakSet</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token comment">// 由于arr数组成员都是数字,因此会报错;</span>\n\n<span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">]</span>\n<span class="token keyword">let</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakSet</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token comment">// 由于arr数组成员都是对象,因此可以;</span>\n</code></pre></div><ol start="3"><li>WeakSet结构下面的三个方法：<code>add</code>()、<code>delete</code>()、<code>has</code>()</li></ol><h2 id="四、map对象"><a class="header-anchor" href="#四、map对象" aria-hidden="true">#</a> 四、map对象</h2><ol><li>类似于对象，键名不局限于字符串，各种类型值(包括对象)都可以当作键；</li></ol><p>map的方法：<code>Map</code>()、<code>Map</code>(array)、<code>set</code>(key, value)、<code>get</code>(key)、<code>delete</code>(key)、<code>has</code>(key)、<code>clear</code>()、<code>size</code>；</p><p>使用需要new实例化，也需要套二维数组；里面写键名和键值；</p><ol start="2"><li>创建一个map对象</li></ol><div class="language-js"><pre><code><span class="token keyword">const</span> curmap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;lishi&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">&#39;age&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;18&#39;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre></div><ol start="3"><li><p>map对象与普通对象的转换;</p><p>将map转换为对象形式：<code>Object.fromEntries(map)</code></p><p>将对象转换map形式：<code>Object.entries(obj)</code></p></li><li><p>使用for..of遍历对象，并使用数组解构；</p></li></ol><div class="language-js"><pre><code><span class="token keyword">let</span> map2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;张三&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">&#39;age&#39;</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">]</span><span class="token punctuation">]</span>\n<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span>value<span class="token punctuation">]</span> <span class="token keyword">of</span> map2<span class="token punctuation">)</span><span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>value<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n<span class="token comment">// 使用Object.entries可以将对象转换成该结构</span>\n</code></pre></div><h3 id="map实用技巧"><a class="header-anchor" href="#map实用技巧" aria-hidden="true">#</a> map实用技巧</h3><p>利用map来改写if判断语句</p><div class="language-js"><pre><code><span class="token keyword">if</span><span class="token punctuation">(</span>status <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>status <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>status <span class="token operator">===</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n\n<span class="token comment">// 改写</span>\n<span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n    <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">]</span>\n<span class="token punctuation">]</span><span class="token punctuation">)</span>\nmap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 执行时记得使用call绑定this指向</span>\n\n\n<span class="token comment">// 二元判断改写</span>\n<span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n    <span class="token punctuation">[</span><span class="token punctuation">{</span>identity<span class="token operator">:</span><span class="token string">&#39;guest&#39;</span><span class="token punctuation">,</span>status<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n    <span class="token punctuation">[</span><span class="token punctuation">{</span>identity<span class="token operator">:</span><span class="token string">&#39;master&#39;</span><span class="token punctuation">,</span>status<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">]</span>\n<span class="token punctuation">]</span><span class="token punctuation">)</span>\n<span class="token keyword">let</span> action <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>map<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>key<span class="token punctuation">,</span>value<span class="token punctuation">]</span></span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span>identity <span class="token operator">===</span> <span class="token string">&#39;guest&#39;</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\naction<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>key<span class="token punctuation">,</span>value<span class="token punctuation">]</span></span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 因为里面是二维数组</span>\n\n\n<span class="token comment">// 如果函数一样, 可以使用记忆函数</span>\n<span class="token keyword">const</span> <span class="token function-variable function">actions</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token function-variable function">actionA</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>\n    <span class="token keyword">let</span> <span class="token function-variable function">actionB</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>\n    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n        <span class="token punctuation">[</span><span class="token punctuation">{</span>identity<span class="token operator">:</span><span class="token string">&#39;guest&#39;</span><span class="token punctuation">,</span>status<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>actionA<span class="token punctuation">]</span><span class="token punctuation">,</span>\n        <span class="token punctuation">[</span><span class="token punctuation">{</span>identity<span class="token operator">:</span><span class="token string">&#39;master&#39;</span><span class="token punctuation">,</span>status<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span>actionA<span class="token punctuation">]</span><span class="token punctuation">,</span>\n        <span class="token punctuation">[</span><span class="token punctuation">{</span>identity<span class="token operator">:</span><span class="token string">&#39;guest&#39;</span><span class="token punctuation">,</span>status<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span>actionB<span class="token punctuation">]</span>\n    <span class="token punctuation">]</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">let</span> action <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token function">actions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>key<span class="token punctuation">,</span>value<span class="token punctuation">]</span></span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span>identity <span class="token operator">==</span> identity <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span>status <span class="token operator">==</span> status<span class="token punctuation">)</span><span class="token punctuation">)</span>\naction<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">[</span>key<span class="token punctuation">,</span>value<span class="token punctuation">]</span><span class="token operator">=&gt;</span><span class="token function">value</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n\n<span class="token comment">// 使用正则判断,将状态码以字符串形式判断</span>\n<span class="token keyword">let</span> <span class="token function-variable function">actions</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token function-variable function">functionA</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>\n    <span class="token keyword">let</span> <span class="token function-variable function">functionB</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>\n    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n        <span class="token punctuation">[</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^guest_[1-4]$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> functionA<span class="token punctuation">]</span><span class="token punctuation">,</span>\n        <span class="token punctuation">[</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^guest_.*$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> functionB<span class="token punctuation">]</span>\n    <span class="token punctuation">]</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">let</span> action <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token function">actions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>key<span class="token punctuation">,</span>value<span class="token punctuation">]</span></span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>identity<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>status<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> action<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>key<span class="token punctuation">,</span>value<span class="token punctuation">]</span></span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token function">value</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n</code></pre></div><p>摘抄： <a href="https://juejin.im/post/5bdfef86e51d453bf8051bf8#heading-1" target="_blank" rel="noopener noreferrer">https://juejin.im/post/5bdfef86e51d453bf8051bf8#heading-1</a></p><h2 id="四、weakmap对象"><a class="header-anchor" href="#四、weakmap对象" aria-hidden="true">#</a> 四、WeakMap对象</h2><ol><li>结构与Map类似，也是用于生成键值对的集合，</li><li>Map与WeakMap的区别</li></ol><p>（1）WeakMap只接受对象作为键名（null除外），不接受其他类型的值，如果放入其他类型会报错</p><div class="language-js"><pre><code><span class="token comment">// WeakMap 可以使用 set 方法添加成员</span>\n<span class="token keyword">const</span> wm1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> key <span class="token operator">=</span> <span class="token punctuation">{</span>foo<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\nwm1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nwm1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token comment">// 2</span>\n\n<span class="token comment">// WeakMap 也可以接受一个数组，</span>\n<span class="token comment">// 作为构造函数的参数</span>\n<span class="token keyword">const</span> k1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> k2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> wm2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span>k1<span class="token punctuation">,</span> <span class="token string">&#39;foo&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>k2<span class="token punctuation">,</span> <span class="token string">&#39;bar&#39;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nwm2<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>k2<span class="token punctuation">)</span> <span class="token comment">// &quot;bar&quot;</span>\n</code></pre></div><p>（2）WeakMap的键名所指向的对象，不计入垃圾回收机制</p><ol start="3"><li>WeakMap的作用：当在对象上面存放一些数据，当我们在这个对象上面存放了数据之后，就会形成对这个对象的引用，因此该对象不再计入垃圾回收机制，如果不再需要，必须手动删除，否则会造成内存泄露， WeakMap就是为了解决此类问题而诞生的</li></ol><div class="language-js"><pre><code><span class="token keyword">const</span> e1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;.box&#39;</span><span class="token punctuation">)</span>\n<span class="token keyword">const</span> e2 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;.demo&#39;</span><span class="token punctuation">)</span>\n<span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>e1<span class="token punctuation">,</span><span class="token string">&#39;box 元素&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>e2<span class="token punctuation">,</span><span class="token string">&#39;demo 元素&#39;</span><span class="token punctuation">]</span><span class="token punctuation">]</span>\narr <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 必须手动删除</span>\n</code></pre></div><ol start="4"><li><p>WeakMap的存放的键名是弱引用，垃圾回收机制不考虑该对象，只有所引用的对象的其他引用都被清除，垃圾回收机制就会释放该对象所占用的内存，不需要手动删除；</p></li><li><p>应用场景：如果想要往对象上面添加数据，又不想干扰垃圾回收机制，就可以使用WeakMap，它所引用的对象，会在将来消失；</p></li></ol><div class="language-js"><pre><code><span class="token keyword">const</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">const</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;example&#39;</span><span class="token punctuation">)</span>\nmap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span><span class="token string">&#39;some information&#39;</span><span class="token punctuation">)</span>\nmap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token comment">// someinformation</span>\n<span class="token comment">// 一旦el被清除，WeakMap的记录会自动被移除;</span>\n</code></pre></div><p>注意：WeakMap弱引用的只是键名，而不是键值，键值依然是正常引用</p><div class="language-js"><pre><code><span class="token keyword">const</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">let</span> key <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>foo<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span>\nmap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>obj<span class="token punctuation">)</span>\nobj <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token comment">// 即使被删除了,key仍可用;</span>\nmap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token comment">// {foo:1}</span>\n</code></pre></div><ol start="6"><li>WeakMap可用方法：get()、set()、has()、delete()；</li></ol><h3 id="weakmap内存实例"><a class="header-anchor" href="#weakmap内存实例" aria-hidden="true">#</a> WeakMap内存实例</h3><p>在cmd打开之后执行以下操作</p><p>如果引用所指向的值占用特别多的内存时，可以使用process.memoryUsage查看，执行--expose-gc可以开启手机执行垃圾回收机制；</p><div class="language-bash"><pre><code>node --expose-gc   <span class="token comment"># --expose-gc表示允许手机执行垃圾回收机制;</span>\n<span class="token operator">&gt;</span> global.gc<span class="token punctuation">(</span><span class="token punctuation">)</span>\nundefined\n<span class="token operator">&gt;</span> process.<span class="token function-name function">memoryUsage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token punctuation">{</span> rss: <span class="token number">21667840</span>,\n  heapTotal: <span class="token number">8110080</span>,\n  heapUsed: <span class="token number">5061480</span>,<span class="token comment"># 内存占用5m  5061480/1024KB*1024Byte</span>\n  external: <span class="token number">8710</span> <span class="token punctuation">}</span>\n\n<span class="token comment"># 先使用普通声明方式, 指向一个5*1024*1024的数组</span>\n<span class="token operator">&gt;</span> <span class="token builtin class-name">let</span> key <span class="token operator">=</span> new Array<span class="token punctuation">(</span><span class="token number">5</span> * <span class="token number">1024</span> * <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nundefined\n<span class="token operator">&gt;</span> <span class="token builtin class-name">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>key,1<span class="token punctuation">]</span><span class="token punctuation">]</span>\nundefined\n<span class="token operator">&gt;</span> process.<span class="token function-name function">memoryUsage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token punctuation">{</span> rss: <span class="token number">65339392</span>,\n  heapTotal: <span class="token number">52162560</span>,\n  heapUsed: <span class="token number">47268584</span>, <span class="token comment">#内存占用47m</span>\n  external: <span class="token number">8712</span> <span class="token punctuation">}</span>\n<span class="token operator">&gt;</span> key <span class="token operator">=</span> null\nnull\n<span class="token operator">&gt;</span> process.<span class="token function-name function">memoryUsage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token punctuation">{</span> rss: <span class="token number">65339392</span>,\n  heapTotal: <span class="token number">52162560</span>,\n  heapUsed: <span class="token number">47268584</span>, <span class="token comment">#引用的key被清楚了,内存还是占用47m</span>\n  external: <span class="token number">8712</span> <span class="token punctuation">}</span>\n<span class="token operator">&gt;</span> arr <span class="token operator">=</span> null  <span class="token comment">#经常容易被删除</span>\nnull\n<span class="token operator">&gt;</span> process.<span class="token function-name function">memoryUsage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token punctuation">{</span> rss: <span class="token number">23592960</span>,\n  heapTotal: <span class="token number">10207232</span>,\n  heapUsed: <span class="token number">5301656</span>, <span class="token comment">#当所有的引用删除之后,内存还原了;</span>\n  external: <span class="token number">8710</span> <span class="token punctuation">}</span>\n\n\n<span class="token comment"># 自行测试使用WeakMap声明, 由于WeakMap声明是弱引用, 因此删除引用对象之后WeakMap对象的引用会自动清除;</span>\n</code></pre></div><ol start="7"><li>WeakMap的用途：典型的场合就是DOM节点作为键名，下面的例子</li></ol><div class="language-js"><pre><code><span class="token keyword">let</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;logo&#39;</span><span class="token punctuation">)</span>\n<span class="token keyword">let</span> wk <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\nwk<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span><span class="token punctuation">{</span>timesClick<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span>\nel<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n    <span class="token keyword">let</span> logoData <span class="token operator">=</span> wk<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span>\n    logoData<span class="token punctuation">.</span>timesClick<span class="token operator">++</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span>\n</code></pre></div><p>当DOM节点被删除时，该状态就会自动消失，不存在内存泄露的风险；</p>',68);t.render=function(a,p,t,e,c,l){return n(),s("div",null,[o])};export default t;export{p as __pageData};
